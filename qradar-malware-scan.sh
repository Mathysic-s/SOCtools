#!/bin/bash
#QRadar Custom Action - Cortex XDR Malware Scan
#Version v0.1 by alan7s

cortex_responder_api=$1 #Fixed Property
cortex_responder_id=$2 #Fixed Property
cortex_fqdn=$3 #Fixed Property
local_ip=$4 #Network Event Property -> sourceip

echo "Trying to do a malware scan at" $local_ip

output=$(curl --request POST \
  --url https://api-$cortex_fqdn.xdr.us.paloaltonetworks.com/public_api/v1/endpoints/scan \
  --header "x-xdr-auth-id: $cortex_responder_id" \
  --header "Authorization: $cortex_responder_api" \
  --header "Accept: application/json" \
  --header "Content-Type: application/json" \
  --data '{ "request_data": {
        "filters": [
            {
                "field": "ip_list",
                "value": ["'"$local_ip"'"],
                "operator": "in"
            }
        ]
    } }')
echo $output
